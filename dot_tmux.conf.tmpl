# Disable `i' for show-message, replace it with opposite of `o'
unbind-key i
bind-key i select-pane -t :.-

# Reverse search to the nbsp contained in $PS1
bind-key P copy-mode\;\
	send-keys -X start-of-line\;\
	send-keys -X search-backward "Â "

set-option -g default-terminal "screen-256color"

set-option -g aggressive-resize on

set-option -g pane-border-status top
set-option -g pane-border-format '[#{pane_index}: #{pane_current_command} #{pane_width}x#{pane_height}] #{pane_mode}'

# Allow ESC to take effect immediately, without acting as META prefix
set-option escape-time 0

{{- if eq .chezmoi.os "darwin" }}

# Homebrew bash if installed
if-shell '[ -x /opt/homebrew/bin/bash ]' {
	set-option -g default-shell /opt/homebrew/bin/bash
}
if-shell '[ -x /usr/local/bin/bash ]' {
	set-option -g default-shell /usr/local/bin/bash
}

# macOS pasteboard integration
#
# https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
# However, we do not need to start bash inside `reattach-to-user-namespace -l`,
# because `set-option -g default-shell` already starts bash as a login shell.
#
unbind-key -T copy-mode-vi Enter
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

{{- end }}

# Ensure that session 'main' always exists. This command will fail if 'main'
# already exists, but silently, since it is the last command in the file.
new-session -d -s main
